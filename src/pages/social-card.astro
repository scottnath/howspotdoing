---
import { getEntry } from 'astro:content';
import SocialCardComponent from '@components/SocialCard.astro';

// Enable server-side rendering for this page to access query params
export const prerender = false;

// Get the location slug from query parameter
const locationParam = Astro.url.searchParams.get('location');

// Redirect to home in production (this page is only for screenshot generation)
if (import.meta.env.MODE === 'production') {
  return Astro.redirect('/');
}

// Default to california if no location provided
const slug = locationParam || 'california';
const locationId = `hpd-${slug}`;

// Get the location data
const locationEntry = await getEntry('locations', locationId);

if (!locationEntry) {
  return new Response('Location not found', { status: 404 });
}

const { answer, location, title, legality } = locationEntry.data;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1200, height=628" />
    <title>Social Card - {location}</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html, body {
        width: 1200px;
        height: 628px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <SocialCardComponent answer={answer} location={location} title={title} legality={legality} />
  </body>
</html>
