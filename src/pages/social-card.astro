---
import { getEntry } from 'astro:content';
import SocialCardComponent from '@components/SocialCard.astro';

// Server-render this page to read query params
// This file is deleted before production builds
export const prerender = false;

// Get the location slug from query parameter
const locationParam = Astro.url.searchParams.get('location');
const slug = locationParam || 'california';
const locationId = `hpd-${slug}`;

// Get the location data
const locationEntry = await getEntry('locations', locationId);

if (!locationEntry) {
  return new Response('Location not found', { status: 404 });
}

const { answer, location, title, legality } = locationEntry.data;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1200, height=628" />
    <title>Social Card - {location}</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html, body {
        width: 1200px;
        height: 628px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <SocialCardComponent answer={answer} location={location} title={title} legality={legality} />
  </body>
</html>
